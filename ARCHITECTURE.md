# Project Architecture

This document explains how the server and frontend are hosted together in the same repository on Vercel.

## Project Structure

```
testproj/
├── api/
│   └── index.ts          # Vercel serverless function (entry point for server)
├── server/
│   ├── index.ts          # Local development server (for Bun)
│   ├── trpc.ts           # Shared tRPC router and procedures
│   └── naturalLanguageParser.ts
├── src/                  # Frontend React app
│   ├── App.tsx
│   ├── main.tsx
│   └── utils/
│       └── trpc.ts       # tRPC client configuration
├── dist/                 # Built frontend (generated by Vite)
├── vercel.json           # Vercel deployment configuration
└── package.json
```

## How It Works

### Local Development

1. **Frontend**: Run `bun run dev` - starts Vite dev server on port 3000
2. **Backend**: Run `bun run dev:server` - starts Hono server on port 3001
3. Frontend connects to backend via `VITE_SERVER_URL` (defaults to `http://localhost:3001`)

### Vercel Deployment

1. **Frontend**: 
   - Built by Vite (`bun run build`) → outputs to `dist/`
   - Served as static files by Vercel

2. **Backend**:
   - `api/index.ts` is automatically detected as a Vercel serverless function
   - It imports and uses the shared server code from `server/trpc.ts`
   - Handles all `/api/trpc/*` routes

3. **Routing**:
   - Frontend requests go to `/trpc/*`
   - `vercel.json` rewrites `/trpc/*` → `/api/trpc/*`
   - Vercel routes `/api/trpc/*` → `api/index.ts` serverless function
   - Hono app handles `/trpc/*` path (relative to `/api`)

## Code Sharing

The server logic is shared between local development and Vercel:

- **`server/trpc.ts`**: Contains the tRPC router, procedures, and business logic
- **`server/index.ts`**: Local development server (uses Bun)
- **`api/index.ts`**: Vercel serverless function (imports from `server/trpc.ts`)

Both `server/index.ts` and `api/index.ts` import the same `appRouter` and `createContext` from `server/trpc.ts`, ensuring consistency.

## Environment Variables

### Local Development
Create a `.env` file:
```env
PORT=3001
CORS_ORIGIN=http://localhost:3000
VITE_SERVER_URL=http://localhost:3001
```

### Vercel
Set in Vercel dashboard:
- `CORS_ORIGIN`: Your Vercel URL (e.g., `https://your-app.vercel.app`)
- `VITE_SERVER_URL`: Your Vercel URL (e.g., `https://your-app.vercel.app`)

## Key Points

1. **Single Repository**: Both frontend and backend code live in the same repo
2. **Shared Server Logic**: `server/trpc.ts` is used by both local dev and Vercel
3. **Automatic Detection**: Vercel automatically detects `api/` folder as serverless functions
4. **No Code Duplication**: Server logic is written once in `server/trpc.ts` and imported by both entry points

## Deployment Flow

```
Git Push → Vercel Build → 
  ├─ Build Frontend (vite build → dist/)
  └─ Deploy Serverless Function (api/index.ts)
     └─ Uses server/trpc.ts (shared code)
```

## Benefits

- ✅ Single repository for frontend and backend
- ✅ Shared server logic (no duplication)
- ✅ Works locally with Bun
- ✅ Deploys to Vercel as serverless functions
- ✅ Automatic scaling on Vercel
- ✅ Type-safe API with tRPC

